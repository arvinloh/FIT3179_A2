{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Population Pyramid of Births by Gender and State",
  "title": {
    "text": "Population Pyramid of Birth by Gender and State",
    "subtitle": "Males vs Females births in Australia by State",
    "fontSize": 25,
    "subtitleFontSize": 20,
    "font": "Roboto",
    "anchor": "start",
    "color": "black"
  },
  "width": 1100,
  "height": 500,
  "background": null,
  "data": {
    "url": "https://raw.githubusercontent.com/arvinloh/FIT3179_A2/main/data/gender_ratio.csv",
    "format": { "type": "csv" }
  },
  "transform": [
    { "filter": "datum.Sex == 'Male' || datum.Sex == 'Female'" },
    {
      "fold": ["NSW", "Vic", "Qld", "WA", "SA", "Tas", "ACT", "NT"],
      "as": ["State", "Number"]
    },
    { "calculate": "toNumber(replace(datum.Number, ',', ''))", "as": "Number" },
    {
      "calculate": "datum.Sex == 'Female' ? -datum.Number : datum.Number",
      "as": "Value"
    },
    {
      "window": [
        {
          "op": "sum",
          "field": "Number",
          "as": "TotalBirths"
        }
      ],
      "frame": [null, null],
      "groupby": ["State"]
    },
    {
      "calculate": "datum.Number / datum.TotalBirths * 100",
      "as": "Percentage"
    },
    {
      "window": [
        {
          "op": "sum",
          "field": "Percentage",
          "as": "TotalPercentage"
        }
      ],
      "frame": [null, null],
      "groupby": ["State"]
    },
    {
      "calculate": "datum.Sex == 'Male' ? datum.Percentage : -datum.Percentage",
      "as": "PercentageValue"
    },
    {
      "window": [
        {
          "op": "sum",
          "field": "PercentageValue",
          "as": "PercentageDifference"
        }
      ],
      "frame": [null, null],
      "groupby": ["State"]
    }
  ],
  "mark": "bar",
  "encoding": {
    "y": {
      "field": "State",
      "type": "ordinal",
      "title": "State",
      "axis": { "labelAngle": 0, "labelFontSize": 16, "titleFontSize": 20 },
      "sort": "x"
    },
    "x": {
      "field": "Value",
      "type": "quantitative",
      "title": "Number of Births",
      "axis": {
        "format": "s",
        "labelExpr": "abs(datum.value)",
        "labelFontSize": 16,
        "titleFontSize": 20
      },
      "scale": {
        "domain": [-51000, 51000]
      }
    },
    "color": {
      "field": "Sex",
      "type": "nominal",
      "scale": { "range": ["#1f77b4", "#ff7f0e"] },
      "legend": {
        "title": "Sex",
        "labelFontSize": 18,
        "titleFontSize": 20,
        "symbolType": "circle",
        "orient": "none",
        "legendX": 900,
        "legendY": 50
      }
    },
    "tooltip": [
      { "field": "State", "type": "nominal" },
      { "field": "Sex", "type": "nominal" },
      {
        "field": "Number",
        "type": "quantitative",
        "title": "Number of Births"
      },
      {
        "field": "Percentage",
        "type": "quantitative",
        "title": "Percentage",
        "format": ".2f"
      },
      {
        "field": "PercentageDifference",
        "type": "quantitative",
        "title": "Percentage Difference",
        "format": ".2f"
      }
    ]
  }
}
